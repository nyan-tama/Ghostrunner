{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(npm run dev|pnpm( run)? dev|yarn dev|bun run dev)\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\necho '[Hook] ブロック: 開発サーバーはログアクセスのためtmux内で実行してください' >&2\necho '[Hook] 代わりにこのコマンドを使用:' >&2\necho \"[Hook] tmux new-session -d -s dev 'npm run dev'\" >&2\necho '[Hook] その後: tmux attach -t dev' >&2\nexit 1"
          }
        ],
        "description": "tmux外での開発サーバーをブロック（フロントエンド）"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"go run.*server\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\necho '[Hook] ブロック: サーバーはログアクセスのためtmux内で実行してください' >&2\necho '[Hook] 代わりにこのコマンドを使用:' >&2\necho \"[Hook] tmux new-session -d -s backend 'go run ./cmd/server'\" >&2\necho '[Hook] その後: tmux attach -t backend' >&2\nexit 1"
          }
        ],
        "description": "tmux外でのGoサーバー実行をブロック（バックエンド）"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(npm (install|test)|pnpm (install|test)|yarn (install|test)|go build|go test|go mod|docker|pytest|vitest|playwright)\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nif [ -z \"$TMUX\" ]; then\n  echo '[Hook] セッション永続化のためtmuxでの実行を推奨' >&2\n  echo '[Hook] tmux new -s dev  |  tmux attach -t dev' >&2\nfi\necho \"$input\""
          }
        ],
        "description": "長時間実行コマンドにtmux使用のリマインダー"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"git push\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\necho '[Hook] プッシュ前に変更を確認中...' >&2\necho '[Hook] Enterで続行、Ctrl+Cで中止...' >&2\nread -r"
          }
        ],
        "description": "git push前に変更確認のため一時停止"
      },
      {
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\\\.(md|txt)$\" && !(tool_input.file_path matches \"README\\\\.md|CLAUDE\\\\.md|AGENTS\\\\.md|CONTRIBUTING\\\\.md\")",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [[ \"$file_path\" =~ \\.(md|txt)$ ]] && [[ ! \"$file_path\" =~ (README|CLAUDE|AGENTS|CONTRIBUTING)\\.md$ ]]; then\n  echo \"[Hook] ブロック: 不要なドキュメントファイルの作成\" >&2\n  echo \"[Hook] ファイル: $file_path\" >&2\n  echo \"[Hook] ドキュメントにはREADME.mdを使用してください\" >&2\n  exit 1\nfi\n\necho \"$input\""
          }
        ],
        "description": "不要な.mdファイル作成をブロック"
      }
    ],
    "PostToolUse": [
      {
        "matcher": "tool == \"Bash\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\ncmd=$(echo \"$input\" | jq -r '.tool_input.command')\n\nif echo \"$cmd\" | grep -qE 'gh pr create'; then\n  output=$(echo \"$input\" | jq -r '.tool_output.output // \"\"')\n  pr_url=$(echo \"$output\" | grep -oE 'https://github.com/[^/]+/[^/]+/pull/[0-9]+')\n  \n  if [ -n \"$pr_url\" ]; then\n    echo \"[Hook] PR作成完了: $pr_url\" >&2\n    echo \"[Hook] GitHub Actionsのステータスを確認中...\" >&2\n    repo=$(echo \"$pr_url\" | sed -E 's|https://github.com/([^/]+/[^/]+)/pull/[0-9]+|\\1|')\n    pr_num=$(echo \"$pr_url\" | sed -E 's|.*/pull/([0-9]+)|\\1|')\n    echo \"[Hook] PRレビュー: gh pr review $pr_num --repo $repo\" >&2\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "PR作成後にURLとレビューコマンドを表示"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx|js|jsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  if command -v prettier >/dev/null 2>&1; then\n    prettier --write \"$file_path\" 2>&1 | head -5 >&2\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "編集後にPrettierでJS/TSファイルを自動フォーマット"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  dir=$(dirname \"$file_path\")\n  project_root=\"$dir\"\n  while [ \"$project_root\" != \"/\" ] && [ ! -f \"$project_root/package.json\" ]; do\n    project_root=$(dirname \"$project_root\")\n  done\n  \n  if [ -f \"$project_root/tsconfig.json\" ]; then\n    cd \"$project_root\" && npx tsc --noEmit --pretty false 2>&1 | grep \"$file_path\" | head -10 >&2 || true\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": ".ts/.tsxファイル編集後にTypeScriptチェック"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx|js|jsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  console_logs=$(grep -n \"console\\\\.log\" \"$file_path\" 2>/dev/null || true)\n  \n  if [ -n \"$console_logs\" ]; then\n    echo \"[Hook] 警告: $file_path にconsole.logが見つかりました\" >&2\n    echo \"$console_logs\" | head -5 >&2\n    echo \"[Hook] コミット前にconsole.logを削除してください\" >&2\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "編集後にconsole.log文を警告（フロントエンド）"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.go$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  if command -v gofmt >/dev/null 2>&1; then\n    gofmt -w \"$file_path\" 2>&1 | head -5 >&2\n  fi\n  if command -v goimports >/dev/null 2>&1; then\n    goimports -w \"$file_path\" 2>&1 | head -5 >&2\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "編集後にgofmt/goimportsでGoファイルを自動フォーマット"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.go$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  dir=$(dirname \"$file_path\")\n  project_root=\"$dir\"\n  while [ \"$project_root\" != \"/\" ] && [ ! -f \"$project_root/go.mod\" ]; do\n    project_root=$(dirname \"$project_root\")\n  done\n  \n  if [ -f \"$project_root/go.mod\" ]; then\n    cd \"$project_root\" && go vet ./... 2>&1 | grep \"$file_path\" | head -10 >&2 || true\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": ".goファイル編集後にgo vetでチェック"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.go$\"",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\nfile_path=$(echo \"$input\" | jq -r '.tool_input.file_path // \"\"')\n\nif [ -n \"$file_path\" ] && [ -f \"$file_path\" ]; then\n  fmt_prints=$(grep -n 'fmt\\.Print' \"$file_path\" 2>/dev/null | grep -v '_test\\.go' || true)\n  \n  if [ -n \"$fmt_prints\" ]; then\n    echo \"[Hook] 警告: $file_path にfmt.Printが見つかりました\" >&2\n    echo \"$fmt_prints\" | head -5 >&2\n    echo \"[Hook] 本番コードではlogパッケージを使用してください\" >&2\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "編集後にfmt.Print文を警告（バックエンド）"
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "#!/bin/bash\ninput=$(cat)\n\nif git rev-parse --git-dir > /dev/null 2>&1; then\n  # Check JS/TS files for console.log\n  js_files=$(git diff --name-only HEAD 2>/dev/null | grep -E '\\.(ts|tsx|js|jsx)$' || true)\n  if [ -n \"$js_files\" ]; then\n    while IFS= read -r file; do\n      if [ -f \"$file\" ] && grep -q \"console\\.log\" \"$file\" 2>/dev/null; then\n        echo \"[Hook] 警告: $file にconsole.logが見つかりました\" >&2\n      fi\n    done <<< \"$js_files\"\n  fi\n\n  # Check Go files for fmt.Print\n  go_files=$(git diff --name-only HEAD 2>/dev/null | grep -E '\\.go$' | grep -v '_test\\.go' || true)\n  if [ -n \"$go_files\" ]; then\n    while IFS= read -r file; do\n      if [ -f \"$file\" ] && grep -q 'fmt\\.Print' \"$file\" 2>/dev/null; then\n        echo \"[Hook] 警告: $file にfmt.Printが見つかりました\" >&2\n      fi\n    done <<< \"$go_files\"\n  fi\nfi\n\necho \"$input\""
          }
        ],
        "description": "セッション終了前に変更ファイルのconsole.log/fmt.Printを最終監査"
      }
    ]
  }
}
