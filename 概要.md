# Ghostrunner

ローカルのClaude Codeを外部からAPI経由で操作するためのローカルAPIサーバー

## アーキテクチャ

```
┌─────────────────┐
│  スマホ          │
│  (Function      │
│   Calling UI)   │
└────────┬────────┘
         │ HTTPS (Tailscale経由)
         ▼
┌─────────────────┐
│  ローカルPC      │
│                 │
│  ┌───────────┐  │
│  │ Go API    │  │
│  │ サーバー   │  │
│  │ :8080     │  │
│  └─────┬─────┘  │
│        │        │
│        ▼        │
│  ┌───────────┐  │
│  │ Claude    │  │
│  │ Code CLI  │  │
│  └───────────┘  │
└─────────────────┘
```

## 技術スタック

- **バックエンド**: Go + Gin
- **フロントエンド**: 単一HTML + JavaScript（Function Calling UI）
- **ネットワーク**: Tailscale（スマホ↔ローカルPC接続）

## プロジェクト構造

```
Ghostrunner/
├── cmd/server/
│   └── main.go              # エントリーポイント + ルーティング
├── internal/
│   ├── handler/
│   │   └── plan.go          # /plan コマンド実行ハンドラー
│   └── service/
│       └── claude.go        # Claude CLI実行サービス
├── web/
│   └── index.html           # Function Calling UI
├── go.mod
├── go.sum
└── 概要.md
```

## API エンドポイント

### POST /api/plan

Claude Codeの `/plan` カスタムコマンドを実行する

**リクエスト:**
```json
{
  "project": "/Users/user/auto-daysupport-cloudrun",
  "args": "新しい機能を追加して"
}
```

**レスポンス:**
```json
{
  "success": true,
  "output": "Claude Codeの出力...",
  "error": ""
}
```

**内部で実行されるコマンド:**
```bash
claude -p "/plan 新しい機能を追加して" --cwd /Users/user/auto-daysupport-cloudrun
```

## 実装計画

### Phase 1: 最小構成（今回）

1. **Go APIサーバーの基本構造を作成**
   - `go.mod` 初期化
   - `cmd/server/main.go` - Ginサーバー起動 + ルーティング
   - 静的ファイル配信（`web/`）

2. **/plan コマンド実行ハンドラー作成**
   - `internal/handler/plan.go`
   - リクエストバリデーション
   - レスポンス整形

3. **Claude CLI実行サービス作成**
   - `internal/service/claude.go`
   - `exec.Command` で `claude` CLI を実行
   - 標準出力・標準エラーの取得

4. **Function Calling UI作成**
   - `web/index.html`
   - プロジェクトパス入力
   - 引数入力
   - 実行ボタン
   - 結果表示エリア

### Phase 2: 機能拡張（将来）

- 他のカスタムコマンド対応（/go, /nextjs, /fullstack）
- 実装計画一覧取得 API
- GitHub状態取得 API
- 実行履歴
- WebSocket でリアルタイム出力

## 起動方法

```bash
cd Ghostrunner
go run ./cmd/server

# http://localhost:8080 でアクセス
```

## Tailscale経由でのアクセス

1. ローカルPCとスマホの両方でTailscaleを有効化
2. ローカルPCのTailscale IP（例: 100.x.x.x）を確認
3. スマホから `http://100.x.x.x:8080` でアクセス
