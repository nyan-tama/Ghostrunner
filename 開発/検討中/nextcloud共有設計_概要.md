# Nextcloud 共有設計 概要

## 目的
外部ストレージ上の顧客フォルダを安全に共有し、顧客ごとに限定公開・期限付き閲覧を実現する。OS差異（Windows / macOS）やドライブレター変動の影響を受けず、運用を安定させる。

---

## 全体構成
- 利用PC: **Windows 2台 / macOS 2台**
- 外部ストレージ: 複数台（顧客データ格納）
- 共有基盤: **Nextcloud**
- 権限・共有設定管理: **クラウド側（例: Cloud Run 等）**

---

## 外部ストレージ運用
### マウント方針
- 外部ストレージは **ボリュームID / シリアル** により識別
- OS側設定により、
  - 常に **固定パス** にマウント
  - ドライブレター変動の影響を受けない

#### 例
- Windows: `C:\mnt\storageA`
- macOS: `/Volumes/storageA`

※ USBポート変更・抜き差し後も同一パスを維持

---

## フォルダ構成
```
[外部ストレージ]
 ├─ customer_001/
 │   ├─ images/
 │   └─ reports/
 ├─ customer_002/
 │   ├─ images/
 │   └─ reports/
 └─ ...
```

- 顧客ごとに完全分離
- 他顧客フォルダの存在は不可視

---

## Nextcloud 共有仕様
### アクセス方法
- 顧客ごとに **専用URL** を発行
- URLアクセス時に **パスワード入力必須**

### 権限
- **読み取り専用**
- ダウンロード / コピー / アップロード不可
- フォルダ階層は顧客配下のみ閲覧可

### 公開期限
- 有効期間: **1か月**
- 期限到来後、自動でアクセス不可

### ログ
- アクセス履歴取得
  - いつ / 誰が / どのファイルにアクセスしたか

---

## 自動化・管理
### 管理主体
- 各PCでは設定・権限管理は行わない
- 共有URL生成 / パスワード設定 / 期限設定は
  - **クラウド側プログラム** で一元管理

### 利用API
- Nextcloud API
  - 共有リンク作成
  - パスワード設定
  - 有効期限設定
  - 権限指定

---

## セキュリティ方針
- 外部ストレージ未接続時
  - ローカル・Nextcloud双方から不可視
- URL流出時も
  - パスワード必須
  - 期限切れで自動無効化

---

## まとめ
- 外部ストレージ × 固定マウント × Nextcloud で
  **安全・省力な顧客データ共有** を実現
- OS・PC台数・ポート差異を吸収
- 手動作業を最小化し、将来的な自動化にも対応可能
