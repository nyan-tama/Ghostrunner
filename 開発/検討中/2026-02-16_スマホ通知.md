# 検討: Claude Code コマンド完了時のスマホ通知

## 質問

スマホに Claude Code のコマンド完了の通知を飛ばすには？ 現在どこまでそのような機能を作ってあるか？

## 現在の実装状況

### 実装済み（Webアプリ側）

| 機能 | ファイル | 状態 |
|------|---------|------|
| デスクトップ通知 | `frontend/src/hooks/useDesktopNotification.ts` | 実装済み |
| 音声通知（OpenAI Realtime） | `frontend/src/hooks/useVoiceNotification.ts` | 実装済み |
| 音声通知（Gemini Live） | `frontend/src/hooks/useGeminiLive.ts` | 実装済み |
| 音声通知UI | `frontend/src/components/VoiceNotificationSection.tsx` | 実装済み |
| page.tsx 統合 | `frontend/src/app/page.tsx` | 実装済み |

これらはすべて **Webアプリ（Ghostrunner）のコマンド実行完了時** の通知機能。ブラウザを開いていれば機能する。

### 未実装

| 機能 | 状態 |
|------|------|
| **Claude Code（CLI）のタスク完了時のスマホ通知** | 未実装 |
| Claude Code hooks での macOS デスクトップ通知 | 未実装 |
| Claude Code hooks での Notification イベント通知 | 未実装 |

### 既存の Claude Code hooks 設定（.claude/settings.json）

- `PreToolUse`: tmux 外ブロック、git push 確認、.md 作成ブロック
- `PostToolUse`: PR URL 表示、Prettier/gofmt、TypeScript/go vet チェック
- `Stop`: console.log/fmt.Print 最終監査のみ（**通知なし**）
- `Notification`: **未設定**

## 仕組み: Claude Code の hooks

Claude Code には公式の hooks 機能がある。以下のイベントでシェルコマンドを実行できる：

| イベント | 用途 |
|---------|------|
| **`Stop`** | タスク完了時 → **スマホ通知に最適** |
| **`Notification`** | 入力待ち・権限要求時 |
| `TaskCompleted` | エージェントタスク完了時 |

`~/.claude/settings.json`（ユーザーグローバル設定）に配置するのが推奨。プロジェクト固有の設定と並列実行される。

## スマホ通知サービスの比較

### 総合比較

| サービス | 費用 | セットアップ | iOS | Android | Apple Watch | 特徴 |
|---------|------|------------|-----|---------|-------------|------|
| **ntfy.sh** | 無料 | 5分 | 対応 | 対応 | 対応 | アカウント不要、最も手軽 |
| **Pushover** | $5 (一回) | 10分 | 対応 | 対応 | 対応 | 高信頼、優先度制御 |
| **Pushcut** | 無料/Pro $2/月 | 10分 | 対応 | 非対応 | 対応 | iOS + Apple Watch 特化 |
| **Slack Webhook** | 無料 | 5分 | 対応 | 対応 | - | 既存 Slack 利用者向け |
| **Discord Webhook** | 無料 | 5分 | 対応 | 対応 | - | 既存 Discord 利用者向け |
| **LINE Messaging** | 無料 (200通/月) | 20-30分 | 対応 | 対応 | - | セットアップが複雑 |

### 推奨

**ntfy.sh** が最も手軽。アカウント登録不要、curl のみで送信可能、5分でセットアップ完了。

## 推奨設定

`~/.claude/settings.json` に追加：

```json
{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "PROJECT=$(basename \"$PWD\") && osascript -e \"display notification \\\"$PROJECT: タスク完了\\\" with title \\\"Claude Code\\\" sound name \\\"Hero\\\"\" && curl -s -H 'Title: Claude Code' -d \"$PROJECT: タスク完了\" ntfy.sh/YOUR_SECRET_TOPIC 2>/dev/null || true",
            "async": true
          }
        ],
        "description": "タスク完了時にmacOS通知とiPhoneプッシュ通知を送信"
      }
    ],
    "Notification": [
      {
        "matcher": "permission_prompt|idle_prompt",
        "hooks": [
          {
            "type": "command",
            "command": "osascript -e 'display notification \"入力を待っています\" with title \"Claude Code\" sound name \"Glass\"' && curl -s -H 'Title: Claude Code' -H 'Priority: high' -d '入力待ち' ntfy.sh/YOUR_SECRET_TOPIC 2>/dev/null || true",
            "async": true
          }
        ],
        "description": "入力待ち・権限要求時にmacOS通知とiPhoneプッシュ通知を送信"
      }
    ]
  }
}
```

## セットアップ手順

1. iPhone の App Store で「ntfy」をインストール（無料）
2. アプリで推測困難なトピック名を購読（例: `claude-work-a8x9k2m7`）
3. macOS で動作確認: `curl -d "テスト" ntfy.sh/claude-work-a8x9k2m7`
4. `~/.claude/settings.json` に上記の設定を追加（`YOUR_SECRET_TOPIC` を置換）
5. Claude Code を再起動

## 注意事項

- 公式のクロスデバイス通知機能は「not planned」（Issue #7590）
- VSCode 拡張では Notification フックが動作しない（Issue #16114）
- フック設定は起動時にスナップショットされる。変更後は再起動が必要
- LINE Notify は 2025年3月31日にサービス終了済み

## 詳細資料

- `/Users/user/Ghostrunner/開発/資料/2026-02-16_Claude_Codeスマホ通知方法.md` - 8サービスの詳細比較
- `/Users/user/Ghostrunner/開発/資料/2026-01-28_Claude_Code処理完了通知.md` - 前回の通知調査
