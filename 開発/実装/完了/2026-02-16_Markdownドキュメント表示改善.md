# 検討結果: Markdownドキュメント表示改善

## 検討経緯

| 日付 | 内容 |
|------|------|
| 2026-02-16 | 初回相談: Docsページでテーブルが表示されない、見出しも対応していない、全体的な表示改善が必要 |
| 2026-02-16 | 調査完了: 根本原因を特定（Tailwind v4でtypographyプラグインが有効化されていない） |

## 背景・目的

フロントエンドの `/docs` ページ（開発ドキュメントビューア）で、Markdownファイルの各要素が正しく表示されていない。`開発/` フォルダ内のドキュメント（実装計画書、検討書など）はテーブル・見出し・コードブロック・リストを多用しているため、正確なレンダリングが業務効率に直結する。

## 対象ユーザー

- 開発者（自分自身） - 実装計画書・検討書を確認する際に使用

## 解決する課題

### 根本原因

**`@tailwindcss/typography` プラグインが Tailwind v4 で有効化されていない。**

`MarkdownViewer.tsx` では `prose` クラスを使用してMarkdownのスタイリングを行っている:

```
<article className="prose prose-lg max-w-none prose-headings:text-gray-800 ...">
```

しかし、`globals.css` には `@import "tailwindcss"` のみ記述されており、typographyプラグインが読み込まれていない。

Tailwind v4 では、プラグインの有効化方法が v3 から変更されている:
- **v3**: `tailwind.config.js` の `plugins` 配列に追加
- **v4**: `globals.css` に `@plugin "@tailwindcss/typography"` を記述

現状の `globals.css`:
```css
@import "tailwindcss";
/* @plugin が存在しない */
```

これにより `prose` クラスが認識されず、以下の要素がすべてプレーンテキストとして表示される。

### 影響を受けるMarkdown要素の一覧

| 要素 | 現状 | 原因 |
|------|------|------|
| テーブル | 罫線なし、整形なし | `prose` のテーブルスタイルが未適用 |
| 見出し（h2-h6） | サイズ・余白が不適切 | `prose` の見出しスタイルが未適用 |
| リスト（ul/ol） | インデント・マーカーなし | `prose` のリストスタイルが未適用 |
| コードブロック | 背景色・パディングが不十分 | `prose` のコードスタイルが未適用 |
| 引用（blockquote） | スタイルなし | `prose` の引用スタイルが未適用 |
| 水平線（hr） | スタイルなし | `prose` のhrスタイルが未適用 |
| 段落間の余白 | 不適切 | `prose` の段落スタイルが未適用 |
| リンク | 色は設定済み（prose-a:text-blue-600） | クラスが認識されないため未適用 |

### 正常に動作している要素

| 要素 | 状況 | 理由 |
|------|------|------|
| Mermaid図 | 正常 | `MermaidRenderer` が独自にレンダリング |
| インラインコード | 部分的に正常 | `components` で直接スタイルを指定（`bg-gray-100 px-1 py-0.5 rounded text-sm`） |
| コードブロック構文ハイライト | 正常（CSSが読み込まれている場合） | `rehype-highlight` が処理 |

### コードブロックの構文ハイライトCSSの問題

`rehype-highlight` は highlight.js をベースにしているが、highlight.js のCSSテーマが `globals.css` や `layout.tsx` で読み込まれていない。構文ハイライトのクラスは付与されるが、対応するCSSがないため色が付かない可能性がある。

## 現状のアーキテクチャ

```
frontend/src/
  app/
    docs/
      page.tsx               -- Docsルートページ（フォルダ一覧）
      [...path]/page.tsx     -- サブパスページ（フォルダ or ファイル表示）
    globals.css              -- Tailwind CSS（typographyプラグイン未設定）
    layout.tsx               -- ルートレイアウト
  components/docs/
    MarkdownViewer.tsx       -- Markdownレンダリング（prose クラス使用）
    MermaidRenderer.tsx      -- Mermaid図レンダリング
    FolderList.tsx           -- フォルダ一覧表示
    Breadcrumb.tsx           -- パンくずナビ
  lib/docs/
    fileSystem.ts            -- ファイルシステム操作
```

### 既に導入済みのライブラリ

| ライブラリ | バージョン | 用途 |
|-----------|-----------|------|
| react-markdown | ^10.1.0 | Markdownパース・レンダリング |
| remark-gfm | ^4.0.1 | GFM拡張（テーブル、取り消し線等）のパース |
| rehype-raw | ^7.0.0 | 生HTML対応 |
| rehype-highlight | ^7.0.2 | コードブロック構文ハイライト |
| mermaid | ^11.12.2 | Mermaid図レンダリング |
| @tailwindcss/typography | ^0.5.19 | Typographyスタイル（**devDependenciesに存在するが未有効化**） |

## 選択肢の検討

### 案A: typographyプラグイン有効化のみ（最小修正）

- 概要: `globals.css` に `@plugin "@tailwindcss/typography"` を1行追加するだけ
- メリット: 変更が最小限（1行）、テーブル・見出し・リスト等すべてが一括で解決する、既に `MarkdownViewer.tsx` の `prose` クラス指定は正しい
- デメリット: コードブロックの構文ハイライトCSSは別途対応が必要
- 工数感: 小

### 案B: typographyプラグイン有効化 + 構文ハイライトCSS追加

- 概要: 案Aに加えて、highlight.js のテーマCSSをインポートし、コードブロックの見た目も改善
- メリット: Markdownのすべての要素が適切に表示される、計画書のコード例も読みやすくなる
- デメリット: 案Aより変更箇所が1-2箇所増える
- 工数感: 小

### 案C: typographyプラグイン有効化 + 構文ハイライトCSS + 追加カスタマイズ

- 概要: 案Bに加えて、proseのカスタムスタイル調整（テーブルのボーダー強調、見出しのアンカーリンク、目次生成など）
- メリット: より洗練されたドキュメント閲覧体験
- デメリット: 実装範囲が広がる、現時点で必要性が低い機能を含む
- 工数感: 中

## MVP提案

**推奨案**: 案B（typographyプラグイン有効化 + 構文ハイライトCSS追加）

### MVP範囲

1. `globals.css` に `@plugin "@tailwindcss/typography"` を追加してtypographyプラグインを有効化
2. highlight.js のテーマCSSをインポート（`globals.css` または `layout.tsx` で）
3. 動作確認: テーブル、見出し、リスト、コードブロック、引用、水平線がすべて正しく表示されること

### 変更対象ファイル（想定）

| ファイル | 変更内容 |
|---------|---------|
| `frontend/src/app/globals.css` | `@plugin "@tailwindcss/typography"` を追加 |
| `frontend/src/app/globals.css` または `layout.tsx` | highlight.js テーマCSS のインポート追加 |

### 次回以降

- テーブルのボーダー強化・横スクロール対応（テーブルが広い場合）
- 見出しへのアンカーリンク付与（URLで特定セクションに直接遷移）
- 目次（TOC）の自動生成
- ダークモード対応
- 印刷用スタイル

## 確認事項

### 要確認: Tailwind v4 での @plugin 構文

Tailwind v4 で `@plugin` ディレクティブが正しく動作するか、実装時に確認が必要。Tailwind v4 のバージョンによっては `@plugin` の代わりに CSS 内での別の指定方法が必要な可能性がある。

### highlight.js テーマの選択

`rehype-highlight` が使用する highlight.js のテーマCSS（例: `github`, `github-dark`, `atom-one-light` など）を選択する必要がある。ドキュメントビューアの背景が白系（`bg-gray-100` + `bg-white`）であるため、ライト系テーマが適切。

## 次のステップ

1. この検討結果を `開発/検討中/` に保存 -- 完了
2. 方針決定後、`/plan` で実装計画を作成
3. 計画確定後、`開発/実装/実装待ち/` に移動
