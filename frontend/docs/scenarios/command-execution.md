# コマンド実行シナリオ

## 概要

Ghost Runner でコマンドを実行するユーザー操作シナリオ。

---

## シナリオ1: 単一ファイルを参照してコマンド実行

### 目的

1つのファイルを参照して plan や research などのコマンドを実行する。

### 前提条件

- プロジェクトパスが有効であること
- 開発フォルダ内にファイルが存在すること

### 操作フロー

1. **Project Path** ドロップダウンからプロジェクトを選択（または履歴ドロップダウンから選択）
2. **Command** ドロップダウンでコマンドを選択（例: /plan）
3. **File** ドロップダウンをクリック（フォーカス時にファイルリストが自動更新される）
4. ドロップダウンからファイルを1つ選択
5. 選択したファイルがドロップダウン下にタグとして表示される
6. **Arguments** に実装内容の説明を入力
7. **Execute Command** ボタンをクリック
8. 進捗表示エリアにイベントが表示される
9. 完了後、結果が表示される

### 成功時

- 選択したファイルの内容を参照したコマンド結果が表示される
- 選択したファイルはタグリストに保持される

### エラー時

- エラーメッセージが赤色で表示される

---

## シナリオ2: 複数ファイルを参照してコマンド実行

### 目的

複数のファイル（資料と検討中ファイルなど）を同時に参照してコマンドを実行する。

### 前提条件

- プロジェクトパスが有効であること
- 開発フォルダ内に複数のファイルが存在すること

### 操作フロー

1. **Project Path** ドロップダウンからプロジェクトを選択（または履歴ドロップダウンから選択）
2. **Command** ドロップダウンでコマンドを選択（例: /plan）
3. **File** ドロップダウンをクリック（フォーカス時にファイルリストが自動更新される）
4. ドロップダウンから1つ目のファイルを選択
5. 選択したファイルがタグとして表示される
6. **File** ドロップダウンをクリックして2つ目のファイルを選択
   - 既に選択済みのファイルはドロップダウン内で checkmark 付き・disabled 表示
7. 2つ目のファイルもタグとして追加される
8. 必要に応じて追加のファイルを選択
9. **Arguments** に実装内容の説明を入力
10. **Execute Command** ボタンをクリック
11. バックエンドに `file1.md file2.md file3.md 引数テキスト` の形式で送信される
12. 進捗表示エリアにイベントが表示される
13. 完了後、結果が表示される

### 成功時

- 選択した全ファイルの内容を参照したコマンド結果が表示される
- 選択したファイルはタグリストに保持される（次回実行時も利用可能）

### エラー時

- エラーメッセージが赤色で表示される

---

## シナリオ3: 選択済みファイルの削除

### 目的

誤って選択したファイル、または不要になったファイルをリストから削除する。

### 前提条件

- 1つ以上のファイルが選択されていること

### 操作フロー

1. 選択済みファイルのタグリストを確認
2. 削除したいファイルのタグ内の **x** ボタンをクリック
3. クリックしたファイルがリストから削除される
4. 必要に応じて他のファイルも削除
5. 全てのファイルを削除した場合、タグリストが非表示になる

### 成功時

- 削除したファイルがタグリストから消える
- ドロップダウン内の該当ファイルの checkmark と disabled が解除される

---

## シナリオ4: ファイルなしでコマンド実行

### 目的

ファイルを参照せずにコマンドを実行する。

### 前提条件

- プロジェクトパスが有効であること

### 操作フロー

1. **Project Path** ドロップダウンからプロジェクトを選択（または履歴ドロップダウンから選択）
2. **Command** ドロップダウンでコマンドを選択
3. **File** は選択しない（または選択済みファイルを全て削除）
4. **Arguments** に説明を入力
5. **Execute Command** ボタンをクリック
6. バックエンドに引数テキストのみが送信される

### 成功時

- 引数のみを使用したコマンド結果が表示される

---

## シナリオ5: 同じファイルを使って連続実行

### 目的

同じファイルを参照して、異なる引数でコマンドを連続実行する。

### 前提条件

- 1回目のコマンド実行が完了していること
- ファイルが選択されていること

### 操作フロー

1. 1回目のコマンド実行が完了
2. 選択済みファイルがタグリストに保持されていることを確認
3. **Arguments** の内容を変更
4. **Execute Command** ボタンをクリック
5. 同じファイルを参照して2回目のコマンドが実行される

### 成功時

- 同じファイルを再選択することなく、連続してコマンドを実行できる

---

## シナリオ6: カメラ撮影で画像を添付してコマンド実行

### 目的

モバイル端末のカメラで撮影した画像を添付してコマンドを実行する。ホワイトボードの写真や紙の資料など、デジタルファイルとして存在しない情報をAIに伝える。

### 前提条件

- プロジェクトパスが有効であること
- デバイスにカメラが搭載されていること（モバイル端末推奨）

### 操作フロー

1. **Project Path** ドロップダウンからプロジェクトを選択（または履歴ドロップダウンから選択）
2. **Command** ドロップダウンでコマンドを選択
3. **Images** セクションの右側にある **Take photo** ゾーンをタップ
4. デバイスのカメラアプリが起動する（背面カメラ）
5. 対象を撮影し、確定する
6. 撮影した画像がプレビューグリッドに追加される
7. 必要に応じて追加の画像を撮影（最大5枚まで）
8. **Arguments** に説明を入力
9. **Execute Command** ボタンをクリック

### 成功時

- 撮影した画像がBase64エンコードされてバックエンドに送信される
- 画像の内容を参照したコマンド結果が表示される

### エラー時

- 5枚を超える場合: 「画像は最大5枚までです」エラーが表示される
- 5MBを超える場合: 「サイズが5MBを超えています」エラーが表示される

### 補足

- デスクトップブラウザでは、カメラ撮影ゾーンをクリックするとファイル選択ダイアログが開く（capture属性のフォールバック動作）
- 左側のドロップゾーンと右側のカメラ撮影ゾーンは併用可能。どちらから追加した画像も同じ配列で管理される

---

## シナリオ7: ドロップゾーンとカメラ撮影を併用して画像添付

### 目的

既存のファイルとカメラ撮影画像を組み合わせてコマンドを実行する。

### 前提条件

- プロジェクトパスが有効であること

### 操作フロー

1. **Images** セクションの左側ドロップゾーンをクリックし、既存の画像ファイルを選択
2. 選択した画像がプレビューグリッドに表示される
3. **Images** セクションの右側カメラ撮影ゾーンをタップし、追加の画像を撮影
4. 撮影した画像もプレビューグリッドに追加される
5. 合計枚数が上限（5枚）以内であることを確認
6. **Execute Command** ボタンをクリック

### 成功時

- ファイル選択と撮影の両方の画像がバックエンドに送信される

### エラー時

- 合計5枚を超える場合: 「画像は最大5枚までです」エラーが表示される

---

## ユースケース例

### 実装計画の作成

**使用コマンド**: /plan

**選択ファイル**:
- 開発/資料/仕様書.md
- 開発/検討中/機能案.md

**引数**: 新機能の実装計画を作成

**結果**: 両方のファイルを参照した実装計画が生成される

### フルスタック実装

**使用コマンド**: /fullstack

**選択ファイル**:
- 開発/資料/API仕様.md
- 開発/実装/実装待ち/機能_plan.md

**引数**: 計画に従って実装

**結果**: 資料と計画書を参照した実装が行われる

### 調査・リサーチ

**使用コマンド**: /research

**選択ファイル**:
- 開発/実装/実装待ち/新機能_plan.md
- 開発/アーカイブ/過去機能.md

**引数**: 重複がないか調査

**結果**: 新旧の内容を比較した調査結果が返される
