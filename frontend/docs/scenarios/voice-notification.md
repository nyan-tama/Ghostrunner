# 音声通知シナリオ

## 概要

Ghost Runner の音声通知機能を利用するユーザー操作シナリオ。OpenAI Realtime API を使用して、コマンドの完了やエラー発生を音声で通知する。

---

## シナリオ1: 音声通知を有効化してコマンド実行

### 目的

長時間実行されるコマンドの完了を音声で通知してもらい、別の作業をしながら待機する。

### 前提条件

- プロジェクトパスが有効であること
- ブラウザがスピーカー出力に対応していること

### 操作フロー

1. **Voice notification** トグルを ON にする
2. 接続状態ドットが黄色（Connecting...）から緑（Connected）に変わるのを確認
3. **Project Path**、**Command**、**Arguments** を入力
4. **Execute Command** ボタンをクリック
5. 別の作業をしながら待機
6. コマンド完了時に音声で「処理が完了しました。[結果の要約]」と通知される

### 成功時

- 音声で完了メッセージが読み上げられる
- 画面上にも結果が表示される

### エラー時

- 音声で「エラーが発生しました。[エラー内容]」と通知される
- 画面上にもエラーが赤色で表示される

---

## シナリオ2: 対話モードで詳細を確認

### 目的

音声通知を受けた後、マイクを使って AI と対話し、結果の詳細を確認する。

### 前提条件

- 音声通知が有効（トグル ON）で接続完了していること
- ブラウザがマイク使用を許可していること

### 操作フロー

1. 音声通知で完了メッセージを受け取る
2. **マイクボタン**（グレー背景）をクリック
3. ブラウザのマイク許可を求められた場合は許可
4. マイクボタンが赤背景に変わり、録音中になる
5. 「もう少し詳しく教えて」など音声で質問
6. AI が音声で応答
7. 対話を続けるか、マイクボタンをクリックして録音を停止

### 成功時

- AI と音声で対話できる
- 録音停止後も接続は維持され、次の通知を受け取れる

### エラー時

- マイク許可が拒否された場合: マイク使用不可
- 対応: ブラウザ設定でマイク許可を付与

---

## シナリオ3: 音声通知を無効化

### 目的

音声通知を一時的に停止する。

### 前提条件

- 音声通知が有効（トグル ON）であること

### 操作フロー

1. **Voice notification** トグルを OFF にする
2. 接続状態ドットがグレー（Disconnected）に変わる
3. 以降のコマンド完了は音声通知されない

### 成功時

- OpenAI Realtime API との接続が切断される
- トグル状態は localStorage に保存され、ページ再読み込み後も OFF のまま

---

## シナリオ4: ページ再読み込み時の自動接続

### 目的

前回のセッションで有効にしていた音声通知を、ページ再読み込み後も継続する。

### 前提条件

- 前回のセッションで音声通知を有効化していたこと

### 操作フロー

1. 音声通知を有効（トグル ON）にしてコマンドを実行
2. ページを再読み込み（F5 またはブラウザの更新ボタン）
3. ページ読み込み完了後、トグルが自動的に ON になる
4. OpenAI Realtime API に自動接続される

### 成功時

- 手動でトグルを ON にすることなく、音声通知が有効になる

---

## シナリオ5: 接続エラーからの復旧

### 目的

接続エラーが発生した場合に再接続する。

### 前提条件

- 音声通知を有効化しようとしたが接続エラーが発生したこと

### 操作フロー

1. **Voice notification** トグルを ON にする
2. 接続状態ドットが赤（Error）になり、「Error」テキストが表示される
3. トグルを一度 OFF にする
4. 再度トグルを ON にする
5. 接続が成功し、ドットが緑（Connected）に変わる

### 成功時

- 再接続に成功し、音声通知が利用可能になる

### エラー時

- 再度エラーが発生した場合: ネットワーク状況を確認

---

## ユースケース例

### 長時間コマンドの待機

**使用機能**: 音声通知

**シナリオ**:
1. `/fullstack` コマンドで大規模な実装を開始
2. Voice notification を ON にして実行
3. 別のウィンドウでドキュメント作成作業
4. 音声で「処理が完了しました」と通知
5. 画面に戻って結果を確認

### 結果の確認と質問

**使用機能**: 音声通知 + 対話モード

**シナリオ**:
1. `/plan` コマンドで実装計画を生成
2. 音声で完了通知を受け取る
3. マイクボタンをクリックして対話モードへ
4. 「この計画のリスクは何？」と音声で質問
5. AI が音声で回答
6. 計画の承認/修正を判断
